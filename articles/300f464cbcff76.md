---
title: "Claude Codeの並列開発を可視化するTUIツール「ccmon」を作ってみた"
emoji: "🖥️"
type: "idea"
topics: ["rust", "claudecode", "cli", "tui", "oss", "個人開発"]
published: false
---

:::message
自分用に作成しており、まだベータ版です。もしご利用される場合は、自己責任でお使いください。
:::

## はじめに

最近Claude codeやGitHub copilotを使った開発では、Git Worktreeを活用して複数のセッションを並列で走らせることが多くなってきました。ターミナルを複数開いていると「どのセッションが今何をしているのか」「どれがユーザー入力待ちなのか」がわからなくなることがあると思います。

そこで、複数のClaude Codeセッションのステータスを一覧できるTUIツール「ccmon」を作ってみました。

↓リポジトリ

https://github.com/Coxless/ccmon

## ccmonとは

**ccmon** (Claude Code Monitor) は、Claude Codeの並列開発セッションをリアルタイムで監視するRust製のCLIツールです。

※ Hooksの機能のためpythonも使ってます

![ccmon ui](/images/300f464cbcff76/ccmon-ui-detail.png)

主な特徴:

- 複数のClaude Codeセッションを1つのダッシュボードで監視
- 各セッションの状態（作業中/待機中/終了）をリアルタイム表示
- 最後のアクティビティ（編集したファイルなど）を確認可能

## ステータス表示

各セッションは以下のステータスで表示されます。

とりあえず、Stopの状態の場合はユーザの入力待ちなんだな、とわかるようにしています。

| 表示 | 状態 | 説明 |
|------|------|------|
| 🔵 In Progress | 作業中 | Claudeがアクティブに作業している |
| 🟡 Stop | 待機中 | 応答完了、ユーザー入力待ち |
| ⚫ Session Ended | 終了 | セッションが終了した |
| 🔴 Error | エラー | エラーが発生した |

## 想定する使い方

ccmonを活用した開発ワークフローの例です。

### 画面レイアウト

- 画面左側: VS Codeを開く
- 画面右上: ccmon UIを起動
- 画面右下: Claude Codeを実行するターミナルを開く

### 手順

1. ccmon UIを起動する
2. 複数のClaude Codeセッションを並列で実行する
3. Stop状態になったセッションを確認し、次のアクションを実行する

![開発イメージ](/images/300f464cbcff76/ccmon-ui.png)

## 仕組み

ccmonはClaude Codeの**Hooks機能**を活用しています。

HooksでClaude codeのステータスをjsonlファイルに記録し、uiで表示するイメージです。

```
Claude Code ─[Hook]→ track-progress.py ─[JSON]→ ~/.claude/task-progress/<session_id>.jsonl
                                                              ↓
                                                       ccmon ui ─[読取]→ TUI表示
```

### 追跡するイベント

Claude Codeの以下のイベントをHooksで捕捉しています:

1. **SessionStart** - セッション開始
2. **UserPromptSubmit** - ユーザーがプロンプトを送信
3. **PostToolUse** - ツール（Write, Edit, Bash等）実行後
4. **Stop** - Claude応答完了、待機中
5. **SessionEnd** - セッション終了

これらのイベントはPythonスクリプトでJSONL形式のログファイルに記録され、ccmonのUIがそれを読み取って表示します。

## インストール

### 必要環境

- Rust 1.91.0+
- Python 3.6+

### ソースからのインストール

```bash
git clone https://github.com/Coxless/ccmon.git
cd ccmon
cargo install --path .
```

## 使い方

### 1. プロジェクトにHooksをセットアップ

監視したいプロジェクトのディレクトリで初期化します:

```bash
cd your-project
ccmon init
```

これにより以下のファイルが作成されます:

- `.claude/settings.json` - Claude CodeのHook設定
- `.claude/hooks/session-init.sh` - セッション初期化Hook
- `.claude/hooks/track-progress.py` - 進捗追跡Hook
- `~/.claude/stop-hook-git-check.sh` - Gitチェック用グローバルHook

### 2. UIを起動

```bash
ccmon ui
```

インタラクティブなTUIが起動し、セットアップ済みのプロジェクトで実行中のClaude Codeセッションが一覧表示されます。

### キーバインド

| キー | 操作 |
|------|------|
| `j` / `↓` | 次のタスクを選択 |
| `k` / `↑` | 前のタスクを選択 |
| `r` | 手動更新 |
| `q` / `Esc` | 終了 |

### 3. 履歴をクリア

```bash
ccmon clear        # 確認あり
ccmon clear --force  # 確認なしでクリア
```

## 今後の展望

現在ベータ版として公開していますが、以下の機能追加を検討しています:

- macOS / Windowsへの対応強化
- 通知機能

## おわりに

Claude Codeで複数セッションを並列で走らせる開発スタイルが増えてきたので、その管理を楽にするツールとしてccmonを作りました。

まだベータ版ですが、同じような課題を感じている方はぜひ試してみてください。フィードバックやPRも歓迎です。
