---
title: "Claude Codeの並列開発を便利にするツール作りたい"
emoji: "🌲"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["rust", "claude", "cli", "開発環境"]
published: false
---

# はじめに

ちょっと前にgit worktreeを使ったclaude codeなどの並列開発が話題になり、今ではvibe kanbanやconductorなどのツールも出ています。

ただ、それらは独自のuiがあり、ターミナルで完結するものが欲しいなと思ったので作成してみました。

画面を大きく使いたいので1ウィンドウでステータス管理、もう一つでclaude codeを開くものです。

repositoryはこちら

https://github.com/Coxless/wtenv

:::message
このツールはまだ開発中（unstable）なので、もしご利用なさる場合はお気をつけください。
linuxとbashでしか動作しないと思います
:::

# wtenvツールの紹介

wtenvは、tuiを備えた並列開発環境のマネージャーを目指しています。

Rustで開発ており、以下の機能を提供します：

- **対話的なworktree作成**: ブランチ名を選択して簡単に作成
- **環境ファイルの自動コピー**: `.env`などを自動的に新しいworktreeにコピー
- **セットアップコマンドの自動実行**: `npm install`などを自動で実行

uiで添付のようなclaude codeの状態を表示してくれます。

想定する使い方は以下です。

- claude codeで並列開発実施
- uiからタスク実行完了したものを確認し再度タスク実行
- 繰り返し

# インストール方法

### バイナリから

```bash
curl -L https://github.com/Coxless/wtenv/releases/latest/download/wtenv-linux-x64 -o wtenv
chmod +x wtenv
sudo mv wtenv /usr/local/bin/
```

## ソースからビルド

```bash
git clone https://github.com/Coxless/wtenv.git
cd wtenv
cargo build --release
# バイナリは target/release/wtenv に生成されます
```

# 基本的な使い方

## 1. 初期化

まず、プロジェクトのルートディレクトリで初期化します：

```bash
wtenv init
```

これで`.worktree.yml`という設定ファイルが生成されます。
.worktree.ymlでコピーの設定やworktree作成後に実行するコマンドを設定します。

## 2. worktreeの作成

対話的にworktreeを作成：

```bash
wtenv create
```

ブランチ名を指定して作成：

```bash
wtenv create feature-auth
```

パスも指定：

```bash
wtenv create feature-auth ~/projects/myapp-feature-auth
```

## 3. worktreeの一覧表示

```bash
wtenv list

# 詳細表示
wtenv list --verbose
```

## 4. worktreeの削除

```bash
wtenv remove ../feature-auth

# 強制削除
wtenv remove ../feature-auth --force
```

# 設定ファイルの活用

`.worktree.yml`を編集することで、worktree作成時の動作をカスタマイズできます。

```yaml
# コピーするファイル（globパターンが使えます）
copy:
  - .env
  - .env.local

# 除外するファイル
exclude:
  - .env.production

# worktree作成後に実行するコマンド
postCreate:
  - command: pnpm install
    description: "依存関係をインストール中..."
    optional: false
```

`postCreate`では、各コマンドに説明（description）やオプション指定（optional）を付けられます。`optional: true`にすると、コマンドが失敗してもworktree作成自体は継続されます。

# Claude Codeとの組み合わせ

wtenvとClaude Codeを組み合わせると、以下のような並列開発ワークフローが実現できます：

## ワークフロー例

```bash
# プロジェクトのルートディレクトリで
cd ~/projects/myapp

# worktreeを作成
wtenv create feature-a
wtenv create feature-b

# それぞれのディレクトリでClaude Codeセッションを開く
cd ../myapp-feature-a
claude  # または VS Code + Claude Code

# 別のターミナルで
cd ~/projects/myapp-feature-b
claude
```

# 実装の工夫

ほとんどClaude codeが実装したのですが、一応wtenvを実装する際に工夫した点をいくつか紹介させてください。

## Rustでの実装理由

- **シングルバイナリ配布**: 依存関係なく1つのバイナリで動作
- **クロスプラットフォーム対応**: Linux、macOS、Windowsで動作（まだ対応してませんがこれからしたいです）
- **高速**: git操作やファイルコピーが高速
- ミニマル実装: 補助ツールとして、最低限の機能を搭載

# 今後の展望

wtenvはまだ開発初期段階ですが、今後以下のような機能を追加していきたいと考えています：

- [ ] クロスプラットフォーム対応
- [ ] AIがこのCLIツールを使いやすくするようにする

# まとめ

wtenvを作成し、Claude Codeでの並列開発をやりやすくしました。

個人的には使えると思ったので自分の開発でどんどん使っていきたいと思います。

あと、ツール作成の難易度が下がっているので、こんな物が欲しいなと思ったら自作できるのがいいですね。

# 参考リンク

- [wtenv GitHubリポジトリ](https://github.com/Coxless/wtenv)
- [Git worktree 公式ドキュメント](https://git-scm.com/docs/git-worktree)
- [Claude Code](https://www.anthropic.com/claude/code)
