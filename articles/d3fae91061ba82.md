---
title: "git worktreeでClaude Codeの並列開発を快適に！wtenvツールを作ってみた"
emoji: "🌲"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["git", "rust", "claude", "cli", "開発環境"]
published: false
---

# はじめに

ちょっと前にgit worktreeを使ったclaude codeなどの並列開発が話題になりました。

最近claude codeに乗り換えたため、並列開発に手を出そうと考えています。

ただ、git worktreeでは、gitignoreされたファイルはコピーされないので、.envファイルを手動で配置する必要があったり、必要なインストールがされてないなどの問題があります。

こういった並列開発の課題を解決するために、と**wtenv**というツールを作ってみました。

skills使えば同じようなことできるのと、似たようなツールがすでにあるのと、最悪シェルスクリプト使えば済むのですが、cliツール開発してみたかったので作成してみました。

:::message
このツールはまだ開発中（unstable）なので、もしご利用なさる場合はお気をつけください。
あと、linuxとbashでしか動作しないと思います
:::

# wtenvツールの紹介

wtenvは、git worktreeの補助として、.envファイル等のコピーやセットアップのスクリプトを実行するツールです。

リポジトリは以下

https://github.com/Coxless/wtenv

wtenvは、Rustで開発ており、以下の機能を提供します：

- **対話的なworktree作成**: ブランチ名を選択して簡単に作成
- **環境ファイルの自動コピー**: `.env`などを自動的に新しいworktreeにコピー
- **セットアップコマンドの自動実行**: `npm install`などを自動で実行

# インストール方法

### バイナリから

```bash
curl -L https://github.com/Coxless/wtenv/releases/latest/download/wtenv-linux-x64 -o wtenv
chmod +x wtenv
sudo mv wtenv /usr/local/bin/
```

## ソースからビルド

```bash
git clone https://github.com/Coxless/wtenv.git
cd wtenv
cargo build --release
# バイナリは target/release/wtenv に生成されます
```

インストール後、`wtenv --version`でバージョンが表示されれば成功です。

# 基本的な使い方

## 1. 初期化

まず、プロジェクトのルートディレクトリで初期化します：

```bash
wtenv init
```

これで`.worktree.yml`という設定ファイルが生成されます。
.worktree.ymlでコピーの設定やworktree作成後に実行するコマンドを設定します。

## 2. worktreeの作成

対話的にworktreeを作成：

```bash
wtenv create
```

ブランチ名を指定して作成：

```bash
wtenv create feature-auth
```

パスも指定：

```bash
wtenv create feature-auth ~/projects/myapp-feature-auth
```

## 3. worktreeの一覧表示

```bash
wtenv list

# 詳細表示
wtenv list --verbose
```

## 4. worktreeの削除

```bash
wtenv remove ../feature-auth

# 強制削除
wtenv remove ../feature-auth --force
```

# 設定ファイルの活用

`.worktree.yml`を編集することで、worktree作成時の動作をカスタマイズできます。

```yaml
# コピーするファイル（globパターンが使えます）
copy:
  - .env
  - .env.local

# 除外するファイル
exclude:
  - .env.production

# worktree作成後に実行するコマンド
postCreate:
  - command: pnpm install
    description: "依存関係をインストール中..."
    optional: false
```

`postCreate`では、各コマンドに説明（description）やオプション指定（optional）を付けられます。`optional: true`にすると、コマンドが失敗してもworktree作成自体は継続されます。

# Claude Codeとの組み合わせ

wtenvとClaude Codeを組み合わせると、以下のような並列開発ワークフローが実現できます：

## ワークフロー例

```bash
# プロジェクトのルートディレクトリで
cd ~/projects/myapp

# worktreeを作成
wtenv create feature-a
wtenv create feature-b

# それぞれのディレクトリでClaude Codeセッションを開く
cd ../myapp-feature-a
claude  # または VS Code + Claude Code

# 別のターミナルで
cd ~/projects/myapp-feature-b
claude
```

# 実装の工夫

ほとんどClaude codeが実装したのですが、一応wtenvを実装する際に工夫した点をいくつか紹介させてください。

## Rustでの実装理由

- **シングルバイナリ配布**: 依存関係なく1つのバイナリで動作
- **クロスプラットフォーム対応**: Linux、macOS、Windowsで動作（まだ対応してませんがこれからしたいです）
- **高速**: git操作やファイルコピーが高速
- ミニマル実装: 補助ツールとして、最低限の機能を搭載

# 今後の展望

wtenvはまだ開発初期段階ですが、今後以下のような機能を追加していきたいと考えています：

- [ ] クロスプラットフォーム対応
- [ ] AIがこのCLIツールを使いやすくするようにする

# まとめ

wtenvを作成し、Claude Codeでの並列開発をやりやすくしました。

個人的には使えると思ったので自分の開発でどんどん使っていきたいと思います。

# 参考リンク

- [wtenv GitHubリポジトリ](https://github.com/Coxless/wtenv)
- [Git worktree 公式ドキュメント](https://git-scm.com/docs/git-worktree)
- [Claude Code](https://www.anthropic.com/claude/code)
